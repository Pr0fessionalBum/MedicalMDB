<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title><%= patient ? 'Edit' : 'Add' %> Patient - Medical DB</title>
  <link rel="stylesheet" href="/style.css">
</head>

<body>

  <!-- NAVBAR -->
  <nav class="navbar">
    <div class="container">
      <h1 class="logo">üè• Medical DB</h1>
      <ul class="nav-links">
        <li><a href="/patients" class="active">Patients</a></li>
        <li><a href="/physicians">Physicians</a></li>
        <li><a href="/prescriptions">Prescriptions</a></li>
        <li><a href="/appointments">Appointments</a></li>
        <li><a href="/billings">Billings</a></li>
        <li><a href="/logout">Logout</a></li>
      </ul>
    </div>
  </nav>

  <div class="container">

    <div class="page-header">
      <h2><%= patient ? "Edit Patient" : "Add New Patient" %></h2>
      <a href="/patients" class="btn btn-secondary">Back to Patients</a>
    </div>

    <!-- FORM CARD -->
    <div class="form-container">

      <form method="POST" 
            action="<%= patient ? `/patients/${patient._id}/edit` : '/patients' %>" 
            class="form">

        <!-- BASIC INFO -->
        <div class="form-row">
          <div class="form-group">
            <label>Full Name *</label>
            <input 
              type="text" 
              name="name" 
              required
              placeholder="John Doe"
              value="<%= patient?.name || '' %>"
            >
          </div>

          <div class="form-group">
            <label>Date of Birth *</label>

            <% 
              let safeDob = '';
              if (patient && patient.dob) {
                try { safeDob = new Date(patient.dob).toISOString().split('T')[0]; } catch(e) {}
              }
            %>

            <input 
              type="date" 
              name="dob" 
              required
              value="<%= safeDob %>"
            >
          </div>
        </div>

        <!-- GENDER -->
        <div class="form-row">
          <div class="form-group">
            <label>Gender *</label>
            <select name="gender" required>
              <option value="">Select Gender</option>
              <option value="male" <%= patient?.gender === "male" ? "selected" : "" %>>Male</option>
              <option value="female" <%= patient?.gender === "female" ? "selected" : "" %>>Female</option>
              <option value="other" <%= patient?.gender === "other" ? "selected" : "" %>>Other</option>
            </select>
          </div>
        </div>

        <div class="form-divider">Contact Information</div>

        <!-- EMAIL + PHONE -->
        <div class="form-row">
          <div class="form-group">
            <label>Email</label>
            <input 
              type="email"
              name="email"
              placeholder="patient@example.com"
              value="<%= patient?.contactInfo?.email || '' %>"
            >
          </div>

          <div class="form-group">
            <label>Phone</label>
            <input 
              type="tel"
              name="phone"
              placeholder="+1 (555) 000-0000"
              value="<%= patient?.contactInfo?.phone || '' %>"
            >
          </div>
        </div>

        <!-- ADDRESS -->
        <div class="form-group">
          <label>Address</label>
          <input 
            type="text"
            name="address"
            placeholder="123 Main St, City, State"
            value="<%= patient?.contactInfo?.address || '' %>"
          >
        </div>

        <!-- SUBMIT -->
        <div class="form-actions">
          <button class="btn btn-primary" type="submit">
            <%= patient ? "Update Patient" : "Add Patient" %>
          </button>
          <a href="/patients" class="btn btn-secondary">Cancel</a>
        </div>

      </form>
    </div>

  </div>

  <footer>
    <p>&copy; 2025 Medical Database Management System</p>
  </footer>

</body>
</html>
